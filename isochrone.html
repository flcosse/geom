<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript">
      $(function(){
      $("#footer").load("footer.html"); 
      });
        </script>
    <link rel="stylesheet" href="style.css">
    <meta charset="utf-8">
    <title>Isochrone</title>
    <link rel="shortcut icon" href="image/compass-solid.svg" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  </head>
  <body>
    <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/atom-one-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/python.min.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
    <div class="container-fluid" id="footer"></div>
      <div class="block">
      <div class="article">
        <h1>Isochrone avec l'api openrouteserivce et Leaflet</h1>
        <div class="tags">
        <h4> <span class="badge bg-secondary">JavaScript</span></h4>
        <h4> <span class="badge bg-secondary">API</span></h4>
        <h4> <span class="badge bg-secondary" style="float:none">Leaflet</span></h4>
        <div class="fi" style="text-align: center">
            <iframe src="leaflet.html"scrolling="no"  frameBorder="0" height="80%" width="100%" title=""></iframe>
         </div>
      <br>
        <pre><code class="javascript">var map = L.map('map').setView([48.856614, 2.3522219], 10);

L.tileLayer('https://{s}.tile.jawg.io/jawg-sunny/{z}/{x}/{y}{r}.png?access-token={accessToken}', {
	attribution: '<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	minZoom: 0,
	maxZoom: 22,
	subdomains: 'abcd',
	accessToken: 'cHwHz2jFd1k6blmFA6wnYur05s8mCVw6336l2GHmEEAWqvCNZ0dfQMazW83EJUHw'
}).addTo(map);

var pan = document.getElementById("pan");
var gen = document.getElementById("gen");

document.getElementById("gen").click();
document.getElementById("pan").onclick= function(){
    document.getElementById("map").style.cursor="grab";
    map.off('click')
    console.log("pan on")
}

document.getElementById("gen").onclick= function(){
    document.getElementById("map").style.cursor="crosshair";

map.on('click', function(e) {
    {const velo = document.getElementById("velo");
    const voiture = document.getElementById("voiture");
    const pieds = document.getElementById("pieds");
    let mode;
    let nom;
    if (velo.checked == true) {
        mode = "cycling-regular"
        nom = "Vélo"
    } else if (voiture.checked == true) {
        mode = "driving-car"
        nom = "Voiture"
    } else if (pieds.checked == true) {
        mode = "foot-walking"
        nom = "À pieds"
    }
    
    var coord = e.latlng;
    var lat = coord.lat;
    var lng = coord.lng;
    let request = new XMLHttpRequest();
    var llat = document.getElementById("lat");
    
    request.open('POST', `https://api.openrouteservice.org/v2/isochrones/${mode}`);

    request.setRequestHeader('Accept', 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8');
    request.setRequestHeader('Content-Type', 'application/json');
    request.setRequestHeader('Authorization', '5b3ce3597851110001cf6248df22650771d94c06a73d6fb78ba4706b');
    var e = document.getElementById("ddlViewBy");

    var value = e.value;
    var text = e.options[e.selectedIndex].text;
    if (text == "Intervalle de 10 minutes"){
        var text = "600,1200,1800,2400,3000,3600"
        var aff = 'Intervalle de 10'
    }
    else {var text = text.split(" ");
        var text = text[0]*60
        var aff = text/60
    }

    var couleur;
    if (aff == 15){
        couleur = "rgb(117, 173, 111)"
    } else if (aff == 30){
        couleur = "rgb(255, 190, 0)"
    } else if (aff == 45){
        couleur = "rgb(255, 126, 1)"
    } else if (aff == 60){
        couleur = "rgb(227, 7, 29)"
    } else{ couleur = "#497bff"}
    
    var polystyle = {
        "color": couleur,
        "weight": 3,
        "opacity": 1,
        "fillOpacity":0.1
    };

    var greenIcon = new L.Icon({
        iconUrl: 'pin.png',
        iconSize: [35, 35],
        iconAnchor: [17, 29],
        popupAnchor: [20, 20],
      });

    request.onreadystatechange = function() {
        if (this.readyState === 4) {
            var data = this.responseText

            L.geoJSON(JSON.parse(data), {style:polystyle}).bindTooltip(`<b>Temps</b> : ${aff} minutes`,{sticky: true}).addTo(map);
        }
    };
    
    const body = `{"locations":[[${String(lng)},${String(lat)}]],"range":[${String(text)}]}`;
    request.send(body);
    map.panTo(new L.LatLng(lat, lng));
    L.marker([lat, lng], {icon:greenIcon}).bindTooltip(`<b>Mode</b> : ${nom}<br><b>Latitude</b> : ${Math.round(lat * 1000) / 1000}<br><b>Longitude</b> : ${Math.round(lng * 1000) / 1000}`).addTo(map);
    document.getElementById("llat").innerHTML = `\xa0${Math.round(lat * 1000) / 1000}`
    document.getElementById("llng").innerHTML = `\xa0${Math.round(lng * 1000) / 1000}`
    var southWest = L.latLng(-89.98155760646617, -180),
    northEast = L.latLng(89.99346179538875, 180);
    var bounds = L.latLngBounds(southWest, northEast);

    map.setMaxBounds(bounds);
    map.on('drag', function() {
        map.panInsideBounds(bounds, { animate: false });
});}
})}

var legend = L.control({ position: "bottomleft" });

legend.onAdd = function(map) {
  var div = L.DomUtil.create("div", "legend");
  div.innerHTML += "<h4>Légende</h4>";
  div.innerHTML += `<i style="background: #D9F8C4"></i><span>15 minutes</span><br>`;
  div.innerHTML += '<i style="background:#F9F9C5"></i><span>30 minutes</span><br>';
  div.innerHTML += '<i style="background: #FAD9A1"></i><span>45 minutes</span><br>';
  div.innerHTML += '<i style="background: #F37878"></i><span>60 minutes</span><br>';

  return div;
};

legend.addTo(map);

</code></pre>
    </div>
</div>

    </body>